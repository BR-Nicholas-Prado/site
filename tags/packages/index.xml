<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>underWater desert Blogging</title><link>https://caseykuhlman.com/</link><description>A Site About Resilience and Authoritarianism</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><managingEditor>casey@caseykuhlman.com (Casey Kuhlman)</managingEditor><webMaster>casey@caseykuhlman.com (Casey Kuhlman)</webMaster><copyright>All Content Licensed CC BY-NC-SA 4.0</copyright><lastBuildDate>Tue, 11 Feb 2014 00:00:00 +0000</lastBuildDate><atom:link href="https://caseykuhlman.com/tags/packages/index.xml" rel="self" type="application/rss+xml"/><item><title>Remembering Your Packages</title><link>https://caseykuhlman.com/muniments/2014/2014-02-11-remember-your-packages/</link><pubDate>Tue, 11 Feb 2014 00:00:00 +0000</pubDate><author>casey@caseykuhlman.com (Casey Kuhlman)</author><guid>https://caseykuhlman.com/muniments/2014/2014-02-11-remember-your-packages/</guid><description>&lt;p>What programs (packages) do I use? This is a perennial problem. It is always easy to remember those packages you use all the time but what about those packages that you do not but you want them there when you need them. Here is a three step system for ensuring that you never forget to reinstall packages you want when you upgrade your system or reinstall you operating system.&lt;/p>
&lt;h2 id="step-1----build-an-install-script">Step 1 &amp;ndash; Build an Install Script&lt;/h2>
&lt;p>I have slowly been speaking about the parts of my installation script over the course of most of my Linux for Lawyers series. I have written about how to use &lt;a href="http://coda.caseykuhlman.com//entries/2014/dropbox-as-a-settings-repository.html">Dropbox as a settings repository&lt;/a> and to automatically pull those settings in when you reinstall your system and I have also written about setting up your &lt;a href="http://coda.caseykuhlman.com//entries/2014/on-shells.html">shell environment&lt;/a>. The system that I use depends in large part on a fairly detailed installation script that I use after installing or reinstalling a Linux operating system. So I keep my packages in that install script.&lt;/p>
&lt;p>My install script contains a long list of the packages which I have installed previously. This is held in an array in shell scripting format. Then the install script builds a function which is creatively called &lt;code>install_a_bunch&lt;/code>. Shell scripting is not terribly easy to follow along with, but what the function essentially does is to first check if the packages I'm trying to install are already installed. Based on the return of the sudo apt-get &amp;ndash;qq &amp;ndash;dry-run call, it parses the packages into three buckets. The first bucket contains those packages which are not installed and can be found in the repositories. The second bucket contains those packages which are already installed. The third bucket contains those packages which cannot be found in the repositories. The final thing the function does is to install those packages which are in the first bucket.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">pkgs&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">(&lt;/span> alacarte audacity blueman chromium-browser cifs-utils conky ..&lt;span style="color:#f92672">[&lt;/span>REDACTED&lt;span style="color:#f92672">]&lt;/span>.. zotero-standalone zsh &lt;span style="color:#f92672">)&lt;/span>
&lt;span style="color:#66d9ef">function&lt;/span> install_a_bunch&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#f92672">)&lt;/span> &lt;span style="color:#f92672">{&lt;/span>
rqst_pkgs&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>@&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
pkgs_inst&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">(&lt;/span> &lt;span style="color:#f92672">)&lt;/span>
&lt;span style="color:#66d9ef">for&lt;/span> pkg in &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>rqst_pkgs[@]&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>; &lt;span style="color:#66d9ef">do&lt;/span>
echo &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">checking for package: &lt;/span>$pkg&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
sudo apt-get -qq --dry-run install $pkg &amp;amp;&amp;gt;/dev/null
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> $? !&lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">100&lt;/span> &lt;span style="color:#f92672">]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span>
dpkg -s $pkg 2&amp;gt;/dev/null | grep -q installed
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span> $? &lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span> &lt;span style="color:#f92672">]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span>
pkgs_inst&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">(&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>pkgs_inst[@]&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>pkg&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#f92672">)&lt;/span>
echo &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$pkg&lt;span style="color:#e6db74">: not installed, will install it.&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">else&lt;/span>
echo &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$pkg&lt;span style="color:#e6db74">: already installed.&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">fi&lt;/span>
&lt;span style="color:#66d9ef">else&lt;/span>
echo &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$pkg&lt;span style="color:#e6db74">: cannot find in the repos, try checking the apt repositories&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">fi&lt;/span>
&lt;span style="color:#66d9ef">done&lt;/span>
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">[&lt;/span> ! &lt;span style="color:#e6db74">${#&lt;/span>pkgs_inst[@]&lt;span style="color:#e6db74">}&lt;/span> &lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span> &lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">]&lt;/span>; &lt;span style="color:#66d9ef">then&lt;/span>
sudo apt-get install -y &lt;span style="color:#e6db74">${&lt;/span>pkgs_inst[@]&lt;span style="color:#e6db74">}&lt;/span>
&lt;span style="color:#66d9ef">else&lt;/span>
echo &lt;span style="color:#e6db74">&amp;#34;nothing to install&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">fi&lt;/span>
&lt;span style="color:#f92672">}&lt;/span>
install_a_bunch &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">${&lt;/span>pkgs[@]&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Linux package managers are decentralized things. This means that you can add and remove other package repositories besides the ones that come pre-installed with the system. In Ubuntu this is done with the add-apt-repository command. The third bucket was put in because many of the packages / programs I use are installed not from the standard repositories but from specialized repositories. In Ubuntu, many packages that are in the standard Ubuntu repositories may be a ways behind the package's latest stable release so it is often necessary to add other repositories which point to the latest stable releases rather than using the standard Ubuntu releases. For example, as of this writing, LibreOffice version 4.1.2 is what is sourced from the standard repositories while version 4.2.0 is sourced from the LibreOffice repositories. For that package and others, I will use the specialized repository rather than the standard repository.&lt;/p>
&lt;h2 id="step-2----setup-your-shell-to-log-repositories-and-packages">Step 2 &amp;ndash; Setup Your Shell to Log Repositories and Packages&lt;/h2>
&lt;p>Once you have an install script ready to go, then the next step is to set up your shell with shortcuts that you can use to both add a repository and install packages while also logging what you are adding into the install script.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#66d9ef">function&lt;/span> install&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;span style="color:#f92672">{&lt;/span>
packages&lt;span style="color:#f92672">=&lt;/span>$@
sudo apt-get install &lt;span style="color:#e6db74">${&lt;/span>=packages&lt;span style="color:#e6db74">}&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> echo &lt;span style="color:#e6db74">&amp;#34;&lt;/span>$packages&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &amp;gt;&amp;gt; ~/.installd
&lt;span style="color:#f92672">}&lt;/span>
apt_pref_compdef install &lt;span style="color:#e6db74">&amp;#34;install&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">function&lt;/span> add-repo&lt;span style="color:#f92672">(&lt;/span>&lt;span style="color:#f92672">)&lt;/span>
&lt;span style="color:#f92672">{&lt;/span>
repos&lt;span style="color:#f92672">=&lt;/span>$@
sudo add-apt-repository -y ppa:&lt;span style="color:#e6db74">${&lt;/span>=repos&lt;span style="color:#e6db74">}&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> echo &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">sudo add-apt-repository -y ppa:&lt;/span>$repos&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &amp;gt;&amp;gt; ~/.installd
sudo apt-get update
&lt;span style="color:#f92672">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The first function above, &lt;code>install&lt;/code>, is used so that when I'm copying and pasting from a site which tells me to do a sudo apt-get install that I just can copy the install and whatever packages I'm to install. The function will do a sudo apt-get install of the packages and then will log those packages in the install script. The line after the install function is a compdef function which enables tab completion in zsh.&lt;/p>
&lt;p>The second function above, &lt;code>add-repo&lt;/code>, is a corollary of the install function. It performs an add-apt-repository call and then logs that in the install script. Finally it performs a sudo apt-get update which you always want to do after you add a repository so that the Ubuntu list of packages gets updated with the packages from the new repository.&lt;/p>
&lt;h2 id="step-3----keep-it-organized">Step 3 &amp;ndash; Keep It Organized&lt;/h2>
&lt;p>The logging functions above will put new repositories and packages at the end of your install script (note, adding onto the end of a text file in shell is super easy with the &lt;code>echo &amp;quot;BLAH&amp;quot; &amp;gt;&amp;gt; FILE&lt;/code> call). Then every once in a while I just organize the script. I cut and paste the repositories into the proper place in my install script and then I use ruby to organize the packages.&lt;/p>
&lt;p>If you have ruby installed on your computer then from shell you type &lt;code>irb&lt;/code>. This will load the interactive ruby console. After that, here is what I do (note the $ below is the cursor):&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-ruby" data-lang="ruby">&lt;span style="color:#960050;background-color:#1e0010">$&lt;/span> a &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">%w(&lt;/span>&lt;span style="color:#e6db74">_CUT_AND_PASTE_THE_PACKAGES_FROM_PKGS_IN_INSTALL_SCRIPT_&lt;/span>&lt;span style="color:#e6db74">)&lt;/span>
&lt;span style="color:#960050;background-color:#1e0010">$&lt;/span> a &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">%w(&lt;/span>&lt;span style="color:#e6db74">_CUT_AND_PASTE_THE_PACKAGES_FROM_THE_BOTTOM_OF_INSTALL_SCRIPT_&lt;/span>&lt;span style="color:#e6db74">)&lt;/span>
&lt;span style="color:#960050;background-color:#1e0010">$&lt;/span> a&lt;span style="color:#f92672">.&lt;/span>flatten&lt;span style="color:#f92672">.&lt;/span>sort&lt;span style="color:#f92672">.&lt;/span>uniq&lt;span style="color:#f92672">.&lt;/span>join(&lt;span style="color:#e6db74">&amp;#39; &amp;#39;&lt;/span>)
&lt;span style="color:#960050;background-color:#1e0010">$&lt;/span> exit
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Then just copy the output from the final ruby call there into your packages array in the install script and delete the packages from the bottom. Then you are all set. You have all your packages logged and up to date.&lt;/p>
&lt;p>Happy Hacking!&lt;/p>
&lt;p>~ # ~&lt;/p></description></item></channel></rss>