<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>underWater desert Blogging</title><link>https://caseykuhlman.com/</link><description>A Site About Resilience and Authoritarianism</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><managingEditor>casey@caseykuhlman.com (Casey Kuhlman)</managingEditor><webMaster>casey@caseykuhlman.com (Casey Kuhlman)</webMaster><copyright>All Content Licensed CC BY-NC-SA 4.0</copyright><lastBuildDate>Sun, 14 Jul 2013 00:00:00 +0000</lastBuildDate><atom:link href="https://caseykuhlman.com/tags/ruby/index.xml" rel="self" type="application/rss+xml"/><item><title>Recent Updates to Legal Markdown Gem</title><link>https://caseykuhlman.com/muniments/2013/2013-07-14-updates-to-legal-markdown/</link><pubDate>Sun, 14 Jul 2013 00:00:00 +0000</pubDate><author>casey@caseykuhlman.com (Casey Kuhlman)</author><guid>https://caseykuhlman.com/muniments/2013/2013-07-14-updates-to-legal-markdown/</guid><description>&lt;p>Had some time this weekend and have dug pretty deep into my &lt;a href="https://github.com/compleatang/legal-markdown">legal_markdown&lt;/a> gem. Mostly the changes should be transparent to users. Now that I feel that am getting a better handle on Ruby, I wanted to refactor the code quite a bit. There were a couple of motivations for this. First, I wanted to put the code more inline with common rubyisms and software construction methods. Second, I wanted to make the gem more flexible. It was fairly straightforward as previously conceived. There was only one class, no modules, and all the functionality resided in one huge file. Third, speed. Although most lmd files will be quite tiny and any modern computer can parse them and refactor them into md files within milliseconds, faster is always &amp;gt; slower.&lt;/p>
&lt;h3 id="refactor-into-multiple-modules-and-classes">Refactor into Multiple Modules and Classes&lt;/h3>
&lt;p>I started the refactor by building two modules. First there is the main LegalMarkdown module which operates as the overall wrapper for the system. I wanted it to be a module so that other code (predominantly &lt;a href="https://github.com/compleatang/rmoc">RMOC&lt;/a>, which is upcoming once I release legal_markdown 1.0) can pull in the gem functionality in a more efficient and modular way. The LegalMarkdown module has a simple controller to direct the actions of the gem. For now it is fairly rudimentary, one of my next steps will be to utilize Ruby's OptionsParser now that the functionality of the gem is becoming more complicated. So the module operates as the parent of the gem, and has one method which controls what the gem does when the module is called. For now there are two modules which live directly &amp;ldquo;under&amp;rdquo; LegalMarkdown. The first module automatically builds the YAML front matter for users. This functionality has existed since v0.1.4 and I have to refactor that code in the coming times. The second module abstracted the LegalToMarkdown functionality into its own module.&lt;/p>
&lt;p>Similarly with the top level module, I abstracted LegalToMarkdown a bit. The entry point to the module is a controller file which determines how the module will perform. The file contains two methods. One of which controls the lmd -&amp;gt; md functionality and another which controls the lmd -&amp;gt; json functionality. There is probably too much logic in this file right now and I likely should abstract some of it to the LegalMarkdown controller which sets everything up to run a parsing incident more efficiently, but it is still a work in progress. To run the parsing incident I abstracted out the previous gem functionality into a couple of other files based on the steps required to parse a file. This is, perhaps, not optimal, but it is what makes sense to me.&lt;/p>
&lt;p>The first step to any parsing incident is to load and parse the input file. This content is an &amp;ldquo;thing&amp;rdquo; in ruby so it made sense that the content to be parse would be put in a class. When I call Class.new, Ruby will load the file, parse it, integrate the proper submodules of LegalToMarkdown module and get everything &amp;ldquo;ready&amp;rdquo; for the LegalToMarkdown controller to run the remainder of the parsing incident. Again, I'm not sure if this optimal software design as I'm still learning, but it seems to make sense to my and I can &amp;ldquo;visualize&amp;rdquo; where everything is at any point in the process.&lt;/p>
&lt;p>The rest of the process I abstracted into modules under LegalToMarkdown so that they can be integrated on a case by case basis depending on what the file needs to actually do. For instance if the file does not have a leaders block then there is no need to run that code. Similarly if the file does not have any mixins or optional clauses there is no need to run that code. It took me a while to figure out how to properly pull in the modules based on the conditions of the content. I still don't feel that I fully understand &lt;code>extend self&lt;/code> and &lt;code>self.extend&lt;/code> and &lt;code>include Module&lt;/code> but in any event, when extending a class with a module what ended up working based on the new design was to call &lt;code>self.extend LegalToMarkdown::Module&lt;/code> from a method in the class which parses the conditions to determine the correct modules to integrate.&lt;/p>
&lt;p>The portion of the code dealing with mixins was integrated into its own Module under the LegalToMarkdown module. Similarly the methods which parse leaders (structured headers) has been put into a different module under the LegalToMarkdown module. The last module I built deals with some particularities required for the &lt;code>--to-json&lt;/code> feature. So at the end of the day, the structure of the gem currently looks like this.&lt;/p>
&lt;blockquote>
&lt;p>module LegalMarkdown&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>-&amp;gt; module LegalToMarkdown&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>-&amp;gt; -&amp;gt; class FileToParse&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>-&amp;gt;-&amp;gt; module Mixin&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>-&amp;gt;-&amp;gt; module Leaders&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>-&amp;gt;-&amp;gt; module BuildJason&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>-&amp;gt; module MakeYAMLFrontmatter&lt;/p>
&lt;/blockquote>
&lt;p>Again, feedback on the structure is very much welcome as I'm still learning how to think about software design.&lt;/p>
&lt;h3 id="testing-suite">Testing Suite&lt;/h3>
&lt;p>I know, I know. You are supposed to have tests for what you do. How else will you know if it is working or not? I'm still learning! In any event, I took some time to build a testing suite. It was actually quite easy. And it greatly simplifies the development process. Thankfully, &lt;a href="https://github.com/twolfson">@twolfson&lt;/a> posted an issue on the github repo which sent me in the correct direction. He said I should build a bunch of simple flat files that represent the input and expected output. This is more or less what I had been doing, although I was not doing it systematically and was just doing it chaotically. Everything I read said that I should start out with testing using Ruby's included test suite rather than RSpec or other more intricate, and capable, test possibilities. So that is currently the basis for the suite. Later, when I'm more comfortable with the process I may switch to RSpec but for now Test::Unit is working just fine.&lt;/p>
&lt;p>One of the things that was important with a process oriented gem like legal_markdown is that when I test things there is a certain sequence in which I want the tests to run. So when I built the lmd files I simply numbered them. Then in the test controller I can simply glob the files, sort the resulting array and then it will always run the tests in a particular order that I want the files to be parsed. This allows me to check the operation of the gem in a particular sequence. That assists in understanding exactly where the problems. After building the lmd files then I ran those through the gem and tweaked a few things in the output markdown files (mostly which were bugs that I needed to work on). Boom, I had a working test suite.&lt;/p>
&lt;p>The basic philosophy for testing is to build these benchmark files. Then the test suite pulls the lmd files, puts them in order, then runs them one by one through the gem and outputs a temp file. Lastly, the test suite compares the temp file output to the benchmark file to ensure they are the same. Later when I add additional functionality or need to test different things, I can simply build a single lmd file that tests for what I need, output that to a md file as a benchmark, number it in the correct order in which I want the test to run and everything else will be taken care of.&lt;/p>
&lt;p>Once I had the test suite built. Then I had to work on the Rakefile to build the testing task. I integrated the github repo with &lt;a href="https://travis-ci.org">Travis&lt;/a> so that it will perform the tests for me on different versions of ruby. Generally I can test the gem quite quickly in 1.9.3 which is primarily what I use for development on my laptop. I run these tests after each piece of code after each piece of code that I've changed during the deeper refactor (below). The advantage of Travis is that it will run the tests on other versions of Ruby very quickly. But to use Travis, and to make running the tests more simple on my machine, I needed to build a rake task that would control the tests. It was very easy after a bit of googling and stack overflowing I had the answer within five minutes. I need to understand how to use rake better, but one thing at a time. For now, here's what the Rakefile looks like:&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-ruby" data-lang="ruby">require &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">bundler/gem_tasks&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
require &lt;span style="color:#e6db74">&amp;#39;rake/testtask&amp;#39;&lt;/span>
&lt;span style="color:#66d9ef">Rake&lt;/span>&lt;span style="color:#f92672">::&lt;/span>&lt;span style="color:#66d9ef">TestTask&lt;/span>&lt;span style="color:#f92672">.&lt;/span>new &lt;span style="color:#66d9ef">do&lt;/span> &lt;span style="color:#f92672">|&lt;/span>t&lt;span style="color:#f92672">|&lt;/span>
t&lt;span style="color:#f92672">.&lt;/span>libs &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">test&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
t&lt;span style="color:#f92672">.&lt;/span>test_files &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">FileList&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#39;test/test*.rb&amp;#39;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>
t&lt;span style="color:#f92672">.&lt;/span>verbose &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>
&lt;span style="color:#66d9ef">end&lt;/span>
task &lt;span style="color:#e6db74">:default&lt;/span> &lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">:test&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>It is very rudimentary for most, but it was cool for me to be able to type &lt;code>rake&lt;/code> into the command line (or if I was feeling verbose &lt;code>bundle exec rake&lt;/code>) and have it run the tests. Plus now Travis runs all the tests on the versions of Ruby which I specify in the .travis.yml file.&lt;/p>
&lt;h3 id="deeper-refactoring">Deeper Refactoring&lt;/h3>
&lt;p>Along with Travis, I also integrated the repo with &lt;a href="https://codeclimate.com">Code Climate&lt;/a>. Both of these tools are free for open source projects and make their money (as Github does) by providing the same, or similar, services for closed source project. I absolutely love this business model. Code Climate looks at your code and analyzes the complexity and redundancy of the code basis. Digging into its analysis of my code basis is teaching me a lot about coding and how to think about coding. For anyone that is reaching the advanced beginner stage of learning to code this is a fantastic tool.&lt;/p>
&lt;p>When I first integrated with Code Climate it gave me a rounding &amp;ldquo;F&amp;rdquo; and my GPA was 0.2. This was eye opening. It was one of the impetuses for my major refactor discussed above. After I parsed everything out into modules, etc. I also had to take a look at the methods and simplify those. Previously I had been thinking of methods as a way to control the flow of the code. So each of logical steps and substeps of the code were built as methods. It worked. But it is suboptimal for reasons I'm still learning. The basic jist is that I needed to greatly simplify what I was doing with my methods. So, mainly in the Leaders module I worked hard to refactor the code so that each method was more simple.&lt;/p>
&lt;p>Still, though, the code base is quite complex. I'm up to a GPA of 1.5 but I have a decent amount of work to do. Some of the complexity it appears to me is inevitable. There are a ton of complexities in what the gem is trying to do. There are ton of switches and branches depending on what the input is. In order to provide the functionality that I want, I'm still trying to figure out how to simplify the code base as much as possible. There appears a tension in what I'm trying to accomplish with the gem and the complexity of the codebase. However, this is hardly the most complex piece of code ever written. Much to learn; much to learn.&lt;/p>
&lt;h3 id="to-json-feature">To Json Feature&lt;/h3>
&lt;p>Some background. I started building legal_markdown because I wanted it to be a simple tool that could provide a basis for a new way of thinking about and creating legal documents. Yet, how to integrate with a ruby gem for non-technical, non-command line users, was a big concern. The average lawyer likely has never looked at the command line. Or at least, not since 1986. So it is fine that I have built in a command line option, but that is only the beginning. The next step was to integrate the gem into a sublime package. I use this package on a daily basis and it makes using the gem dead simple. Users can install sublime, install Package control, install the legal markdown package and go. Still there is the ruby requirement, but at least that is a surmountable obstacle.&lt;/p>
&lt;p>The problem with working with lmd files in sublime is primarily that it is not a very elegant solution for reading and annotating documents. Currently if I want to read a lmd file, it is damn easy. I simply run the Legal Markdown to Markdown command in sublime and then run the Preview Markdown command from the Markdown Preview package and it opens automatically in the browser. Two commands. It is not bad, but it could be better.&lt;/p>
&lt;p>These are some of the concerns behind &lt;a href="https://github.com/compleatang/rmoc">RMOC&lt;/a>. To read and annotate files will require a more complex structure than simple markdown is capable of providing. There are a couple of options for richer file formats than simple text based format such as markdown. For now, the primary &amp;ldquo;rich&amp;rdquo; format that legal_markdown will support is JSON. As I stated in this &lt;a href="https://github.com/compleatang/legal-markdown/issues/2">issue&lt;/a> , JSON is readily available for all major programming/scripting languages; generally parses faster and is easier to work with than xml (the other major option); and also integrates with databases very well.&lt;/p>
&lt;p>In addition, I've been a fan for a while of what the team building &lt;a href="http://substance.io">Substance&lt;/a> is doing. So, I've built the to-json feature of legal_markdown so that it outputs in a format which will fully integrate with Substance. Then when I build the Read component of RMOC I can simply use a lot of their code to build the reading and annotating portion of RMOC.&lt;/p>
&lt;p>Building the feature was not really troublesome. Once you have a good idea of how to work with hashes in ruby then it is really a simple matter to build JSON documents. You simply assemble the code into one large hash and then dump that hash into a JSON.&lt;/p>
&lt;h2 id="lessons-learned">Lessons Learned&lt;/h2>
&lt;ul>
&lt;li>Classes = things. Files are things. A file is a Class. Functionality goes in modules&lt;/li>
&lt;li>Modules are ways to keep blocks of code so that they can be integrated when necessary&lt;/li>
&lt;li>Methods should have a singular function&lt;/li>
&lt;li>Nested hashes area bit troublesome when the keys are id's and you only know the values rather than the keys. Have to loop through each_value and work the search that way. Also, Enumerable::detect is good for this.&lt;/li>
&lt;li>Don't be afraid of tests. They aren't that complex.&lt;/li>
&lt;/ul>
&lt;p>Happy Hacking!&lt;/p>
&lt;p>~ # ~&lt;/p></description></item><item><title>Flat Lexie Does Javascript</title><link>https://caseykuhlman.com/muniments/2013/2013-04-25-flat-lexie-does-javascript/</link><pubDate>Thu, 25 Apr 2013 00:00:00 +0000</pubDate><author>casey@caseykuhlman.com (Casey Kuhlman)</author><guid>https://caseykuhlman.com/muniments/2013/2013-04-25-flat-lexie-does-javascript/</guid><description>&lt;p>This week I threw together a little site for the daughter of some friends. Lexie is my friends&amp;rsquo; daughter and she is lovely. She had to do a Flat Stanley project but she named it Flat Lexie instead. So they sent me a Flat Lexie and we basically travelled the world together &amp;ndash; flat lexie and I. We had a few adventures so I wanted to try to capture the pictures I took but also to capture the geography and background of the different places. Indeed, this is supposed to be the point of the Flat Stanley/Flat Lexie exercises for kids to know about the world. In any event, &lt;a href="http://flatlexie.caseykuhlman.com">here&lt;/a> is the result; &lt;a href="https://github.com/compleatang/flat-lexie">here&lt;/a> is the code.&lt;/p>
&lt;p>It is a simple Sinatra app (first for me), running on Heroku (another first for me), which integrates the &lt;a href="https://github.com/HPNeo/gmaps">gMaps&lt;/a> package I installed with Bower (first, first), and a bit of jQuery I added along the way to tie everything together (not a first).&lt;/p>
&lt;h2 id="lessons-learned">Lessons Learned&lt;/h2>
&lt;p>What did I learn?&lt;/p>
&lt;ul>
&lt;li>I like Ruby.&lt;/li>
&lt;li>I'm not sure I like javascript.&lt;/li>
&lt;li>At a minimum, I'm pretty awful at javascript.&lt;/li>
&lt;li>In any event I'm more comfortable with Ruby.&lt;/li>
&lt;li>Sinatra is smooth.&lt;/li>
&lt;li>Heroku is smooth.&lt;/li>
&lt;li>I still have to figure out how to pass JSON data to javascript run views from Ruby controllers that doesn't rely on data attributes &amp;ndash; as that feels like such a patch.&lt;/li>
&lt;/ul>
&lt;h2 id="how">How&lt;/h2>
&lt;p>The chunk that took me the biggest portion of time was building the javascript file that would tie gMaps, jQuery and the view together. I built the view so it would preload all of the images in boxes that I wanted to slideToggle the display of in sequence. This was straight-forward jQuery, nothing special there.&lt;/p>
&lt;p>Then I wanted the map which comprises a 100%x100% background to move around zoom in and zoom out on certain events. Basically I wanted the map to start zoomed out, so that Lexie could see the context, and then after waiting a few seconds I wanted to zoom in to the pinpoint location. When moving to the next picture in the series I wanted the sequence to run like this: slideToggle the old picture/entry, I wanted the map to zoom out to a preestablished zoom level (which depended on how &amp;ldquo;big&amp;rdquo; the transition was), then I wanted to put a marker in the new location, then I wanted the map to slide its center over to the new location. It turned out to be not that difficult. gMaps is a great API wrapper for Google Maps API. Between gMaps and jQuery it wasn't that difficult to craft.&lt;/p>
&lt;p>Still I have some issues with javascript. My issues aren't with javascript per se, as in they are the language's problem, they are my problem in that I don't really know how to use the language properly yet. I still don't fully understand how to call functions and functions as extensable objects is still quite confusing to me and also variable scope is killing me. Both of these Ruby is much more straight-forward about (or else I've read more about and understand better). So if anyone wants to point out the innumerable flaws and less than optimal code in the javascript below I'm happy to learn.&lt;/p>
&lt;p>In any event, my script that tied the whole thing together and made Flat Lexie works.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="color:#a6e22e">$&lt;/span>(document).&lt;span style="color:#a6e22e">ready&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>(){
&lt;span style="color:#75715e">// Hide the boxes that are not the first box
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;.box&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">slice&lt;/span>(&lt;span style="color:#ae81ff">1&lt;/span>).&lt;span style="color:#a6e22e">hide&lt;/span>();
&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;.section a[href^=&amp;#39;http://&amp;#39;]&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">attr&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;target&amp;#34;&lt;/span>,&lt;span style="color:#e6db74">&amp;#34;_blank&amp;#34;&lt;/span>);
&lt;span style="color:#75715e">// Title toggles the view of the content box
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;.title &amp;gt; a&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">click&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>(){
&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;content&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">slideToggle&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;fast&amp;#39;&lt;/span>);
});
&lt;span style="color:#75715e">// Initial variables
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">LAT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;.box&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">first&lt;/span>().&lt;span style="color:#a6e22e">data&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;lat&amp;#39;&lt;/span>),
&lt;span style="color:#a6e22e">LNG&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;.box&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">first&lt;/span>().&lt;span style="color:#a6e22e">data&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;long&amp;#39;&lt;/span>),
&lt;span style="color:#a6e22e">ZM_OUT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>,
&lt;span style="color:#a6e22e">ZM_IN&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">20&lt;/span>;
&lt;span style="color:#75715e">// Set the initial map
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">map&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> &lt;span style="color:#a6e22e">GMaps&lt;/span>({
&lt;span style="color:#a6e22e">div&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#e6db74">&amp;#39;#map&amp;#39;&lt;/span>,
&lt;span style="color:#a6e22e">zoom&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">ZM_OUT&lt;/span>,
&lt;span style="color:#a6e22e">mapTypeId&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">google&lt;/span>.&lt;span style="color:#a6e22e">maps&lt;/span>.&lt;span style="color:#a6e22e">MapTypeId&lt;/span>.&lt;span style="color:#a6e22e">HYBRID&lt;/span>,
&lt;span style="color:#a6e22e">lat&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">LAT&lt;/span>,
&lt;span style="color:#a6e22e">lng&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">LNG&lt;/span>
});
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() {&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">addMarker&lt;/span>({ &lt;span style="color:#a6e22e">lat&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">LAT&lt;/span>, &lt;span style="color:#a6e22e">lng&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">LNG&lt;/span>, });}, &lt;span style="color:#ae81ff">1250&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() {&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">setZoom&lt;/span>(&lt;span style="color:#a6e22e">ZM_IN&lt;/span>);}, &lt;span style="color:#ae81ff">2500&lt;/span>);
&lt;span style="color:#75715e">// Previous_event clicks should be hidden on the first box, the rest should run the previous transition
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;.previous_event&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">click&lt;/span>(&lt;span style="color:#a6e22e">prevTransition&lt;/span>);
&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;.box&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">first&lt;/span>().&lt;span style="color:#a6e22e">children&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;.previous_event&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">hide&lt;/span>();
&lt;span style="color:#75715e">// Next event should run, and reloop if it is the last box
&lt;/span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;.next_event&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">click&lt;/span>(&lt;span style="color:#a6e22e">nextTransition&lt;/span>);
&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;.box&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">last&lt;/span>().&lt;span style="color:#a6e22e">children&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;.next_event&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">click&lt;/span>(&lt;span style="color:#a6e22e">reloopTransition&lt;/span>);
&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">nextTransition&lt;/span>() {
&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;.nav a&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">addClass&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;disabled&amp;#39;&lt;/span>);
&lt;span style="color:#a6e22e">TRANS&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">parents&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;.box&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">data&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;transition&amp;#39;&lt;/span>);
&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">TRANS&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;bigTrans&amp;#34;&lt;/span>)
&lt;span style="color:#a6e22e">ZM_OUT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>;
&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">TRANS&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;medTrans&amp;#34;&lt;/span>)
&lt;span style="color:#a6e22e">ZM_OUT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>;
&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">TRANS&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;smallTrans&amp;#34;&lt;/span>)
&lt;span style="color:#a6e22e">ZM_OUT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">16&lt;/span>;
&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">TRANS&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;microTrans&amp;#34;&lt;/span>)
&lt;span style="color:#a6e22e">ZM_OUT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">20&lt;/span>;
&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">setZoom&lt;/span>(&lt;span style="color:#a6e22e">ZM_OUT&lt;/span>);
&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">parents&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;.box&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">slideToggle&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;slow&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>(){
&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">next&lt;/span>().&lt;span style="color:#a6e22e">slideToggle&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;slow&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>(){
&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">LAT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">data&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;lat&amp;#39;&lt;/span>),
&lt;span style="color:#a6e22e">LNG&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">data&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;long&amp;#39;&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() {&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">addMarker&lt;/span>({ &lt;span style="color:#a6e22e">lat&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">LAT&lt;/span>, &lt;span style="color:#a6e22e">lng&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">LNG&lt;/span>, });}, &lt;span style="color:#ae81ff">750&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() {&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">setCenter&lt;/span>(&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">markers&lt;/span>[&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">markers&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>].&lt;span style="color:#a6e22e">getPosition&lt;/span>().&lt;span style="color:#a6e22e">lat&lt;/span>(), &lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">markers&lt;/span>[&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">markers&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>].&lt;span style="color:#a6e22e">getPosition&lt;/span>().&lt;span style="color:#a6e22e">lng&lt;/span>());}, &lt;span style="color:#ae81ff">1200&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() {&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">setZoom&lt;/span>(&lt;span style="color:#a6e22e">ZM_IN&lt;/span>);}, &lt;span style="color:#ae81ff">3750&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() {&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;.nav a&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">removeClass&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;disabled&amp;#39;&lt;/span>)}, &lt;span style="color:#ae81ff">4000&lt;/span>);
});
});
};
&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">prevTransition&lt;/span>() {
&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">addClass&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;disabled&amp;#39;&lt;/span>);
&lt;span style="color:#a6e22e">TRANS&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">parents&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;.box&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">prev&lt;/span>().&lt;span style="color:#a6e22e">data&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;transition&amp;#39;&lt;/span>);
&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">TRANS&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;bigTrans&amp;#34;&lt;/span>)
&lt;span style="color:#a6e22e">ZM_OUT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>;
&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">TRANS&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;medTrans&amp;#34;&lt;/span>)
&lt;span style="color:#a6e22e">ZM_OUT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">8&lt;/span>;
&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">TRANS&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;smallTrans&amp;#34;&lt;/span>)
&lt;span style="color:#a6e22e">ZM_OUT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">16&lt;/span>;
&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">TRANS&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;microTrans&amp;#34;&lt;/span>)
&lt;span style="color:#a6e22e">ZM_OUT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">20&lt;/span>;
&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">setZoom&lt;/span>(&lt;span style="color:#a6e22e">ZM_OUT&lt;/span>);
&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">parents&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;.box&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">slideToggle&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;slow&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>(){
&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">prev&lt;/span>().&lt;span style="color:#a6e22e">slideToggle&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;slow&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>(){
&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">LAT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">data&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;lat&amp;#39;&lt;/span>),
&lt;span style="color:#a6e22e">LNG&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">data&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;long&amp;#39;&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() {&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">addMarker&lt;/span>({ &lt;span style="color:#a6e22e">lat&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">LAT&lt;/span>, &lt;span style="color:#a6e22e">lng&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">LNG&lt;/span>, });}, &lt;span style="color:#ae81ff">750&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() {&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">setCenter&lt;/span>(&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">markers&lt;/span>[&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">markers&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>].&lt;span style="color:#a6e22e">getPosition&lt;/span>().&lt;span style="color:#a6e22e">lat&lt;/span>(), &lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">markers&lt;/span>[&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">markers&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>].&lt;span style="color:#a6e22e">getPosition&lt;/span>().&lt;span style="color:#a6e22e">lng&lt;/span>());}, &lt;span style="color:#ae81ff">1200&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() { &lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">setZoom&lt;/span>(&lt;span style="color:#a6e22e">ZM_IN&lt;/span>); }, &lt;span style="color:#ae81ff">3750&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() {&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">removeClass&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;disabled&amp;#39;&lt;/span>)}, &lt;span style="color:#ae81ff">4500&lt;/span>);
});
});
};
&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">reloopTransition&lt;/span>() {
&lt;span style="color:#a6e22e">ZM_OUT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">4&lt;/span>;
&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">setZoom&lt;/span>(&lt;span style="color:#a6e22e">ZM_OUT&lt;/span>);
&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">parents&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;.box&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">slideToggle&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;slow&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>(){
&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">siblings&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;:first&amp;#34;&lt;/span>).&lt;span style="color:#a6e22e">slideToggle&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;slow&amp;#39;&lt;/span>, &lt;span style="color:#66d9ef">function&lt;/span>(){
&lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">LAT&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">data&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;lat&amp;#39;&lt;/span>),
&lt;span style="color:#a6e22e">LNG&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#66d9ef">this&lt;/span>).&lt;span style="color:#a6e22e">data&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;long&amp;#39;&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() {&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">addMarker&lt;/span>({ &lt;span style="color:#a6e22e">lat&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">LAT&lt;/span>, &lt;span style="color:#a6e22e">lng&lt;/span>&lt;span style="color:#f92672">:&lt;/span> &lt;span style="color:#a6e22e">LNG&lt;/span>, });}, &lt;span style="color:#ae81ff">750&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() {&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">setCenter&lt;/span>(&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">markers&lt;/span>[&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">markers&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>].&lt;span style="color:#a6e22e">getPosition&lt;/span>().&lt;span style="color:#a6e22e">lat&lt;/span>(), &lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">markers&lt;/span>[&lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">markers&lt;/span>.&lt;span style="color:#a6e22e">length&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>].&lt;span style="color:#a6e22e">getPosition&lt;/span>().&lt;span style="color:#a6e22e">lng&lt;/span>());}, &lt;span style="color:#ae81ff">1200&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() { &lt;span style="color:#a6e22e">map&lt;/span>.&lt;span style="color:#a6e22e">setZoom&lt;/span>(&lt;span style="color:#a6e22e">ZM_IN&lt;/span>); }, &lt;span style="color:#ae81ff">3750&lt;/span>);
&lt;span style="color:#a6e22e">setTimeout&lt;/span>(&lt;span style="color:#66d9ef">function&lt;/span>() {&lt;span style="color:#a6e22e">$&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;a&amp;#39;&lt;/span>).&lt;span style="color:#a6e22e">removeClass&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;disabled&amp;#39;&lt;/span>)}, &lt;span style="color:#ae81ff">4500&lt;/span>);
});
});
};
});
&lt;/code>&lt;/pre>&lt;/div>
&lt;p>For the record, Flat Lexie can easily be adopted to your needs if you have a Flat Stanley project to do. Just fork the repo, add your pictures, add the datapoints.json lat/longs, write any copy you may want and &lt;code>git push heroku&lt;/code>. Voila.&lt;/p>
&lt;p>Happy Hacking everyone!&lt;/p>
&lt;p>~ # ~&lt;/p></description></item><item><title>Migrating underWater desert Blogging to Jekyll</title><link>https://caseykuhlman.com/muniments/2013/2013-04-18-migrating-udb-to-jekyll/</link><pubDate>Thu, 18 Apr 2013 00:00:00 +0000</pubDate><author>casey@caseykuhlman.com (Casey Kuhlman)</author><guid>https://caseykuhlman.com/muniments/2013/2013-04-18-migrating-udb-to-jekyll/</guid><description>&lt;p>Wordpress is a great system. A really great system, actually. Especially for non-technical users. It also requires a huge amount of overhead for what most people use it for. Also, it is not nearly as fast and reliable as I would like it to be. So I decided that my blog needed to move from Wordpress to Jekyll. I had been using the same blog theme for about four years now so I also wanted to refactor that. Here's what I did to migrate it.&lt;/p>
&lt;h3 id="step-1-install-ben-balters-migrate-to-jekyll-plugin">Step 1: Install Ben Balter's Migrate to Jekyll Plugin&lt;/h3>
&lt;p>First, I downloaded Ben's migrate &lt;a href="https://github.com/benbalter/wordpress-to-jekyll-exporter">plugin&lt;/a> for Wordpress. Then I unzipped that into my plugins directory in my Wordpress install (which I deploy from my workstation using git), enable the plugin and click Tools -&amp;gt; Export to Jekyll. Then the server will chew on it for a while and spit out a decent zip. The zip file has the templates (which I didn't use as I was rebuilding them from scratch and didn't care what the old ones looked like), the posts, and the pages you have on your blog.&lt;/p>
&lt;p>There were a few annoyances with the output, though. These annoyances are not any problem with the Exporter which worked as I expected it would. They were mainly annoyances with a lot of rust that is within the code/database of my blog. That rust was one of the main reasons that I wanted to switch to Jekyll. Since Jekyll is simply plain text files it is much simpler to iterate over the files and make the changes.&lt;/p>
&lt;h3 id="step-2-build-the-jekyll-deploy-how-i-wanted-it-to-look">Step 2: Build the Jekyll Deploy How I Wanted it to Look&lt;/h3>
&lt;p>Next, I worked on the layouts, includes, html files, config, rakefile and put everything how I wanted it to be. This was simple web design and there are lots of tutorials which were quite helpful in this endeavour. Once the Jekyll deployment looked and acted how I wanted it to, it was time to chew on the files.&lt;/p>
&lt;h3 id="step-3-build-a-ruby-script-to-reformulate-the-posts-how-i-wanted">Step 3: Build a Ruby Script to Reformulate the Posts How I Wanted&lt;/h3>
&lt;p>The first problem that I had with the export was that the yaml frontmatter was loaded with a lot of crap that I neither needed nor wanted for the Jekyll. So I thought I would build a small ruby script that would clean the YAML Frontmatter. Here's the part of the script that does that.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-ruby" data-lang="ruby"> &lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#a6e22e">clean_the_yaml&lt;/span>( yaml_block, first_para )
new_yaml &lt;span style="color:#f92672">=&lt;/span> {}
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">layout&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">post&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">if&lt;/span> yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">title&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">title&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>
yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">title&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>gsub!(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&amp;#39;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">if&lt;/span> yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">title&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=~&lt;/span> &lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">A&amp;#34;&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">title&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">title&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>
&lt;span style="color:#66d9ef">else&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">title&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">title&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">end&lt;/span>
&lt;span style="color:#66d9ef">else&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">title&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">end&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">published&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">true&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">comments&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">true&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">meta&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">true&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">if&lt;/span> yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">categories&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">category&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">categories&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>first&lt;span style="color:#f92672">.&lt;/span>downcase
&lt;span style="color:#66d9ef">else&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">category&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">category&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">unclassified&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">end&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">tags&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">tags&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">tags&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>
&lt;span style="color:#66d9ef">if&lt;/span> yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> yaml_block&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>gsub(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>strip &lt;span style="color:#66d9ef">if&lt;/span> new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;gt;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">else&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> first_para&lt;span style="color:#f92672">.&lt;/span>gsub(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">end&lt;/span>
&lt;span style="color:#66d9ef">if&lt;/span> new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#f92672">..&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>gsub!(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">else&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>gsub!(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)
&lt;span style="color:#66d9ef">end&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>strip &lt;span style="color:#66d9ef">unless&lt;/span> new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#ae81ff">0&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#f92672">||&lt;/span> new_yaml&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">excerpt&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">.&lt;/span>length &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>
&lt;span style="color:#f92672">&lt;/span>final_yaml &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">---&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
new_yaml&lt;span style="color:#f92672">.&lt;/span>each{ &lt;span style="color:#f92672">|&lt;/span> head, val &lt;span style="color:#f92672">|&lt;/span> final_yaml &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> head &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">: &lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> val&lt;span style="color:#f92672">.&lt;/span>to_s &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span> }
final_yaml &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">---&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">end&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>That prt of the script mainly strips out the old rust from the YAML front matter and ensures that all my punctuation will not get in the way of Jekyll doing its job. For instance, I had lots of colons in my titles and these are a problem with YAML if you do not escape them or put the string in double quotes. Also I wanted all the posts to have some sort of a excerpt so if I did not have an excerpt in the Wordpress, I built the script to import the first paragraph and then escaped it and guarded against problems with punctuation in the paragraphh.&lt;/p>
&lt;p>The second thing I had to overcome was the way the exporter handled images embedded in the text was not really how I wanted it. I am not sure if the exporter was made to export images or not, but I think because I run a multisite deployment &amp;ndash; and because Wordpress handles multisite files much differently than single site files &amp;ndash; that the images were a problem.&lt;/p>
&lt;p>When I looked on my machine in the Blogs.dir for the Blog I was exporting I saw another problem which was that Wordpress saves a lot of different versions of the same file. This was going to be a problem when I tried to import the photos into the Jekyll asset pipeline I built.&lt;/p>
&lt;p>I was used to the ruby &lt;code>system&lt;/code> command but there was a problem when I tried to drop the return of the system command into a variable. And then I came upon my new favorite rubyism: backticks. These were great. They work just like backticks in bash/zsh scripting so they were quite intuitive. They run a system command and throw the result of that into a string variable &amp;ndash; which you can split, strip, do whatever you need. This let me build a &lt;code>find&lt;/code> command that I could use to get over the multiple files issue.&lt;/p>
&lt;p>I also needed to reformulate &lt;em>how&lt;/em> the images were called within the text. Wordpress puts a caption (which I almost always used) and the exporter used the reference link syntax that I don't particularly prefer in markdown. So I wanted to reform that part of the source posts. Here's the part of the script that did that.&lt;/p>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-ruby" data-lang="ruby">&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#a6e22e">clean_the_content&lt;/span>( entry_block )
pictures_pattern &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">A(&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">[&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">!&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">[(.*?)&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">])(.*?&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">z)&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>
file_pattern &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">A&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">s*&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">[&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">]:(.*?&lt;/span>&lt;span style="color:#e6db74">\/&lt;/span>&lt;span style="color:#e6db74">(.*?))&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">z&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>
delete_lines &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#f92672">]&lt;/span>
&lt;span style="color:#66d9ef">for&lt;/span> para &lt;span style="color:#66d9ef">in&lt;/span> entry_block &lt;span style="color:#66d9ef">do&lt;/span>
&lt;span style="color:#66d9ef">if&lt;/span> para&lt;span style="color:#f92672">[&lt;/span>pictures_pattern&lt;span style="color:#f92672">]&lt;/span>
pict_line &lt;span style="color:#f92672">=&lt;/span> $1
caption &lt;span style="color:#f92672">=&lt;/span> $2
rest_of_it &lt;span style="color:#f92672">=&lt;/span> $3
picture_to_copy &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>
&lt;span style="color:#66d9ef">next&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> rest_of_it&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">A&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">(&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">{&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#f92672">]&lt;/span>
p_index &lt;span style="color:#f92672">=&lt;/span> entry_block&lt;span style="color:#f92672">.&lt;/span>index para
delete_lines &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> entry_block&lt;span style="color:#f92672">[&lt;/span>p_index &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> entry_block&lt;span style="color:#f92672">[&lt;/span>p_index &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#f92672">]&lt;/span>&lt;span style="color:#f92672">[&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#e6db74">\&lt;/span>&lt;span style="color:#e6db74">A&lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>caption&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#f92672">]&lt;/span>
&lt;span style="color:#66d9ef">if&lt;/span> entry_block&lt;span style="color:#f92672">[&lt;/span>(p_index &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#f92672">&lt;/span>)&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=~&lt;/span> file_pattern
full_pict_ref &lt;span style="color:#f92672">=&lt;/span> $1&lt;span style="color:#f92672">.&lt;/span>strip
picture_to_copy &lt;span style="color:#f92672">=&lt;/span> $2&lt;span style="color:#f92672">.&lt;/span>split(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)&lt;span style="color:#f92672">.&lt;/span>last
delete_lines &lt;span style="color:#f92672">&amp;lt;&amp;lt;&lt;/span> entry_block&lt;span style="color:#f92672">[&lt;/span>p_index &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">5&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#f92672">]&lt;/span>
picture_to_copy &lt;span style="color:#f92672">=&lt;/span> copy_over_pictures( picture_to_copy )
&lt;span style="color:#66d9ef">end&lt;/span>
&lt;span style="color:#66d9ef">if&lt;/span> picture_to_copy
entry_block&lt;span style="color:#f92672">[&lt;/span>p_index&lt;span style="color:#f92672">]&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>pict_line&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">({{ site.url }}{{ site.root }}{{ site.images_dir }}/{{ page.date | date: &lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">%Y&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74"> }}/&lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>picture_to_copy&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">)][&lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>full_pict_ref&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">]&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
&lt;span style="color:#66d9ef">end&lt;/span>
&lt;span style="color:#66d9ef">end&lt;/span>
&lt;span style="color:#66d9ef">end&lt;/span>
delete_lines&lt;span style="color:#f92672">.&lt;/span>each{ &lt;span style="color:#f92672">|&lt;/span> line &lt;span style="color:#f92672">|&lt;/span> entry_block&lt;span style="color:#f92672">.&lt;/span>delete( line ) }
&lt;span style="color:#66d9ef">return&lt;/span> entry_block
&lt;span style="color:#66d9ef">end&lt;/span>
&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">&lt;/span>&lt;span style="color:#f92672">&lt;/span>&lt;span style="color:#a6e22e">copy_over_pictures&lt;/span>( picture_name )
location &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">`&lt;/span>&lt;span style="color:#e6db74">find &lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>@pictures_pull_dir&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74"> -name &amp;#39;&lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>picture_name&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">*&amp;#39; -type f | sort -nr&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>
&lt;span style="color:#66d9ef">if&lt;/span> location &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
location &lt;span style="color:#f92672">=&lt;/span> location&lt;span style="color:#f92672">.&lt;/span>split(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)&lt;span style="color:#f92672">.&lt;/span>first&lt;span style="color:#f92672">.&lt;/span>strip
picture_name &lt;span style="color:#f92672">=&lt;/span> location&lt;span style="color:#f92672">.&lt;/span>split(&lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>)&lt;span style="color:#f92672">.&lt;/span>last
&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#e6db74">`&lt;/span>&lt;span style="color:#e6db74">ls &lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>@pictures_push_dir&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>@publish_year&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">`&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>; &lt;span style="color:#e6db74">`&lt;/span>&lt;span style="color:#e6db74">mkdir &lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>@pictures_push_dir&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>@publish_year&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>; &lt;span style="color:#66d9ef">end&lt;/span>
&lt;span style="color:#e6db74">`&lt;/span>&lt;span style="color:#e6db74">cp &lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>location&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74"> &lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>@pictures_push_dir&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>@publish_year&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>picture_name&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>
&lt;span style="color:#66d9ef">return&lt;/span> picture_name
&lt;span style="color:#66d9ef">else&lt;/span>
&lt;span style="color:#e6db74">`&lt;/span>&lt;span style="color:#e6db74">echo &amp;#34;Error importing to &lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>@publish_year&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74"> the file: &lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>location&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">/&lt;/span>&lt;span style="color:#e6db74">#{&lt;/span>picture_name&lt;span style="color:#e6db74">}&lt;/span>&lt;span style="color:#e6db74">&amp;#34; &amp;gt;&amp;gt; cleaner-errors.log&lt;/span>&lt;span style="color:#e6db74">`&lt;/span>
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>
&lt;span style="color:#66d9ef">end&lt;/span>
&lt;span style="color:#66d9ef">end&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;p>That was it. Just a few regexs and a few deletes and a few system commands.&lt;/p>
&lt;h3 id="step-4-put-it-all-together--see-what-we-have">Step 4. Put it all Together &amp;amp;&amp;amp; See What We Have&lt;/h3>
&lt;p>After I built the script and tested it on a few of the more recent posts I needed to run it on the entire directory of posts. I kept the posts in a separate directory out of the repo so if anything got screwed up with the script I could just re run it. I ended up having to do that a couple of times as I had to tweak my original version of the script a bit to arrive at what is presented above.&lt;/p>
&lt;pre>&lt;code>rm -rf _posts &amp;amp;&amp;amp; cp ~/Downloads/jekyll-export/_posts . -R &amp;amp;&amp;amp; git add _posts &amp;amp;&amp;amp; ./cleaner.rb
&lt;/code>&lt;/pre>&lt;p>One of the first things I realized was that I needed to add the &lt;code>_posts&lt;/code> dir to the the repo again as when you run jekyll it will &lt;code>git ls-files&lt;/code>. So I ran the above command until I was happy with the results and then I finally ran this command.&lt;/p>
&lt;pre>&lt;code>rm -rf _posts &amp;amp;&amp;amp; cp ~/Downloads/jekyll-export/_posts . -R &amp;amp;&amp;amp; git add _posts &amp;amp;&amp;amp; ./cleaner.rb &amp;amp;&amp;amp; rake site:publish
&lt;/code>&lt;/pre>&lt;p>That was it! The full cleaner script can be found in &lt;a href="https://gist.github.com/compleatang/5401492">this gist&lt;/a>. If you want to use it, download it into the root of Jekyll, &lt;code>chmod +x cleaner.rb&lt;/code> and you will be all set.&lt;/p>
&lt;h3 id="lessons-learned">Lessons Learned.&lt;/h3>
&lt;ul>
&lt;li>Testing of scripts is huge. I still don't really know how to do this but I tested it with sample data and was prepared for things to go wrong.&lt;/li>
&lt;li>Backticks. FTW.&lt;/li>
&lt;/ul>
&lt;p>~ # ~&lt;/p></description></item></channel></rss>