<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="casey@caseykuhlman.com Casey Kuhlman"><meta name=description content="Thoughts and tips on how I migrated from Wordpress to Jekyll."><meta name=keywords content="legaltech,resilience,authoritarianism,ruby,jekyll,blogging"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://caseykuhlman.com/muniments/2013/2013-04-18-migrating-udb-to-jekyll/><title>Migrating underWater desert Blogging to Jekyll :: underWater desert Blogging â€” A Site About Resilience and Authoritarianism</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.min.84ed5579024525d4b50458514d1a43e40dd5272df45c7cd6da85b225af457154.css><meta itemprop=name content="Migrating underWater desert Blogging to Jekyll"><meta itemprop=description content="Thoughts and tips on how I migrated from Wordpress to Jekyll."><meta itemprop=datePublished content="2013-04-18T00:00:00+00:00"><meta itemprop=dateModified content="2020-04-12T00:06:38+01:00"><meta itemprop=wordCount content="1337"><meta itemprop=image content="https://caseykuhlman.com/img/udp.jpg"><meta itemprop=keywords content="ruby,jekyll,blogging,"><meta property="og:title" content="Migrating underWater desert Blogging to Jekyll"><meta property="og:description" content="Thoughts and tips on how I migrated from Wordpress to Jekyll."><meta property="og:type" content="article"><meta property="og:url" content="https://caseykuhlman.com/muniments/2013/2013-04-18-migrating-udb-to-jekyll/"><meta property="og:image" content="https://caseykuhlman.com/img/udp.jpg"><meta property="article:published_time" content="2013-04-18T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-12T00:06:38+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://caseykuhlman.com/img/udp.jpg"><meta name=twitter:title content="Migrating underWater desert Blogging to Jekyll"><meta name=twitter:description content="Thoughts and tips on how I migrated from Wordpress to Jekyll."><meta property="article:section" content="ruby"><meta property="article:published_time" content="2013-04-18 00:00:00 +0000 UTC"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>cd ~/</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://caseykuhlman.com/posts>Entries</a></li><li><a href=https://caseykuhlman.com/about>Me, About</a></li><li><a href=https://caseykuhlman.com/muniments>Muniments</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://caseykuhlman.com/muniments/2013/2013-04-18-migrating-udb-to-jekyll/>Migrating underWater desert Blogging to Jekyll</a></h2><div class=post-content><p>Wordpress is a great system. A really great system, actually. Especially for non-technical users. It also requires a huge amount of overhead for what most people use it for. Also, it is not nearly as fast and reliable as I would like it to be. So I decided that my blog needed to move from Wordpress to Jekyll. I had been using the same blog theme for about four years now so I also wanted to refactor that. Here's what I did to migrate it.</p><h3 id=step-1-install-ben-balters-migrate-to-jekyll-plugin>Step 1: Install Ben Balter's Migrate to Jekyll Plugin</h3><p>First, I downloaded Ben's migrate <a href=https://github.com/benbalter/wordpress-to-jekyll-exporter>plugin</a> for Wordpress. Then I unzipped that into my plugins directory in my Wordpress install (which I deploy from my workstation using git), enable the plugin and click Tools -> Export to Jekyll. Then the server will chew on it for a while and spit out a decent zip. The zip file has the templates (which I didn't use as I was rebuilding them from scratch and didn't care what the old ones looked like), the posts, and the pages you have on your blog.</p><p>There were a few annoyances with the output, though. These annoyances are not any problem with the Exporter which worked as I expected it would. They were mainly annoyances with a lot of rust that is within the code/database of my blog. That rust was one of the main reasons that I wanted to switch to Jekyll. Since Jekyll is simply plain text files it is much simpler to iterate over the files and make the changes.</p><h3 id=step-2-build-the-jekyll-deploy-how-i-wanted-it-to-look>Step 2: Build the Jekyll Deploy How I Wanted it to Look</h3><p>Next, I worked on the layouts, includes, html files, config, rakefile and put everything how I wanted it to be. This was simple web design and there are lots of tutorials which were quite helpful in this endeavour. Once the Jekyll deployment looked and acted how I wanted it to, it was time to chew on the files.</p><h3 id=step-3-build-a-ruby-script-to-reformulate-the-posts-how-i-wanted>Step 3: Build a Ruby Script to Reformulate the Posts How I Wanted</h3><p>The first problem that I had with the export was that the yaml frontmatter was loaded with a lot of crap that I neither needed nor wanted for the Jekyll. So I thought I would build a small ruby script that would clean the YAML Frontmatter. Here's the part of the script that does that.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>  <span style=color:#66d9ef>def</span> <span style=color:#a6e22e></span><span style=color:#f92672></span><span style=color:#a6e22e>clean_the_yaml</span>( yaml_block, first_para )
    new_yaml <span style=color:#f92672>=</span> {}
    new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>layout</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>post</span><span style=color:#e6db74>&#34;</span>
    <span style=color:#66d9ef>if</span> yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>title</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>&amp;&amp;</span> yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>title</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span>
      yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>title</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span><span style=color:#f92672>.</span>gsub!(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>, <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#39;</span><span style=color:#e6db74>&#34;</span>)
      <span style=color:#66d9ef>if</span> yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>title</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=~</span> <span style=color:#e6db74>/</span><span style=color:#e6db74>\</span><span style=color:#e6db74>A&#34;</span><span style=color:#e6db74>/</span>
        new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>title</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>title</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span>
      <span style=color:#66d9ef>else</span>
        new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>title</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>+</span> yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>title</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>
      <span style=color:#66d9ef>end</span>
    <span style=color:#66d9ef>else</span>
      new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>title</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#34;</span>
    <span style=color:#66d9ef>end</span>
    new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>published</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>true</span><span style=color:#e6db74>&#34;</span>
    new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>comments</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>true</span><span style=color:#e6db74>&#34;</span>
    new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>meta</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>true</span><span style=color:#e6db74>&#34;</span>
    <span style=color:#66d9ef>if</span> yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>categories</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span>
      new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>category</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>categories</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span><span style=color:#f92672>.</span>first<span style=color:#f92672>.</span>downcase 
    <span style=color:#66d9ef>else</span>
      new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>category</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>category</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>unclassified</span><span style=color:#e6db74>&#34;</span>
    <span style=color:#66d9ef>end</span>
    new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>tags</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>tags</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>if</span> yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>tags</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span>
    <span style=color:#66d9ef>if</span> yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span>
      new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> yaml_block<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span><span style=color:#f92672>.</span>gsub(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#34;</span>)
      new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#ae81ff>2</span><span style=color:#f92672></span><span style=color:#f92672>..</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672></span><span style=color:#f92672>]</span><span style=color:#f92672>.</span>strip <span style=color:#66d9ef>if</span> new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672></span><span style=color:#f92672>]</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&gt;</span><span style=color:#e6db74>&#34;</span>
    <span style=color:#66d9ef>else</span>
      new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> first_para<span style=color:#f92672>.</span>gsub(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>, <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>&#34;</span>)
    <span style=color:#66d9ef>end</span>
    <span style=color:#66d9ef>if</span> new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672></span><span style=color:#f92672>]</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>
      new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#ae81ff>1</span><span style=color:#f92672></span><span style=color:#f92672>..</span><span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672></span><span style=color:#f92672>]</span><span style=color:#f92672>.</span>gsub!(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>, <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>&#34;</span>)
    <span style=color:#66d9ef>else</span>
      new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span><span style=color:#f92672>.</span>gsub!(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>, <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>&#34;</span>)
    <span style=color:#66d9ef>end</span>
    new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>+</span>  new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span><span style=color:#f92672>.</span>strip <span style=color:#66d9ef>unless</span> new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#ae81ff>0</span><span style=color:#f92672></span><span style=color:#f92672>]</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>
    new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span> <span style=color:#66d9ef>if</span> new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672></span><span style=color:#f92672>]</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>||</span> new_yaml<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>excerpt</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span><span style=color:#f92672>.</span>length <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>
    <span style=color:#f92672></span>final_yaml <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>---</span><span style=color:#ae81ff>\n</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
    new_yaml<span style=color:#f92672>.</span>each{ <span style=color:#f92672>|</span> head, val <span style=color:#f92672>|</span> final_yaml <span style=color:#f92672>&lt;&lt;</span> head <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>: </span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>+</span> val<span style=color:#f92672>.</span>to_s <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span> }
    final_yaml <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>---</span><span style=color:#ae81ff>\n</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>
  <span style=color:#66d9ef>end</span></code></pre></div><p>That prt of the script mainly strips out the old rust from the YAML front matter and ensures that all my punctuation will not get in the way of Jekyll doing its job. For instance, I had lots of colons in my titles and these are a problem with YAML if you do not escape them or put the string in double quotes. Also I wanted all the posts to have some sort of a excerpt so if I did not have an excerpt in the Wordpress, I built the script to import the first paragraph and then escaped it and guarded against problems with punctuation in the paragraphh.</p><p>The second thing I had to overcome was the way the exporter handled images embedded in the text was not really how I wanted it. I am not sure if the exporter was made to export images or not, but I think because I run a multisite deployment &ndash; and because Wordpress handles multisite files much differently than single site files &ndash; that the images were a problem.</p><p>When I looked on my machine in the Blogs.dir for the Blog I was exporting I saw another problem which was that Wordpress saves a lot of different versions of the same file. This was going to be a problem when I tried to import the photos into the Jekyll asset pipeline I built.</p><p>I was used to the ruby <code>system</code> command but there was a problem when I tried to drop the return of the system command into a variable. And then I came upon my new favorite rubyism: backticks. These were great. They work just like backticks in bash/zsh scripting so they were quite intuitive. They run a system command and throw the result of that into a string variable &ndash; which you can split, strip, do whatever you need. This let me build a <code>find</code> command that I could use to get over the multiple files issue.</p><p>I also needed to reformulate <em>how</em> the images were called within the text. Wordpress puts a caption (which I almost always used) and the exporter used the reference link syntax that I don't particularly prefer in markdown. So I wanted to reform that part of the source posts. Here's the part of the script that did that.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#66d9ef>def</span> <span style=color:#a6e22e></span><span style=color:#f92672></span><span style=color:#a6e22e>clean_the_content</span>( entry_block )
  pictures_pattern <span style=color:#f92672>=</span> <span style=color:#e6db74>/</span><span style=color:#e6db74>\</span><span style=color:#e6db74>A(</span><span style=color:#e6db74>\</span><span style=color:#e6db74>[</span><span style=color:#e6db74>\</span><span style=color:#e6db74>!</span><span style=color:#e6db74>\</span><span style=color:#e6db74>[(.*?)</span><span style=color:#e6db74>\</span><span style=color:#e6db74>])(.*?</span><span style=color:#e6db74>\</span><span style=color:#e6db74>z)</span><span style=color:#e6db74>/</span>
  file_pattern <span style=color:#f92672>=</span> <span style=color:#e6db74>/</span><span style=color:#e6db74>\</span><span style=color:#e6db74>A</span><span style=color:#e6db74>\</span><span style=color:#e6db74>s*</span><span style=color:#e6db74>\</span><span style=color:#e6db74>[</span><span style=color:#e6db74>\</span><span style=color:#e6db74>]:(.*?</span><span style=color:#e6db74>\/</span><span style=color:#e6db74>(.*?))</span><span style=color:#e6db74>\</span><span style=color:#e6db74>z</span><span style=color:#e6db74>/</span>
  delete_lines <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#f92672>]</span>
  <span style=color:#66d9ef>for</span> para <span style=color:#66d9ef>in</span> entry_block <span style=color:#66d9ef>do</span>
    <span style=color:#66d9ef>if</span> para<span style=color:#f92672>[</span>pictures_pattern<span style=color:#f92672>]</span>
      pict_line <span style=color:#f92672>=</span> $1
      caption <span style=color:#f92672>=</span> $2
      rest_of_it <span style=color:#f92672>=</span> $3
      picture_to_copy <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
      <span style=color:#66d9ef>next</span> <span style=color:#66d9ef>if</span> rest_of_it<span style=color:#f92672>[</span><span style=color:#e6db74>/</span><span style=color:#e6db74>\</span><span style=color:#e6db74>A</span><span style=color:#e6db74>\</span><span style=color:#e6db74>(</span><span style=color:#e6db74>\</span><span style=color:#e6db74>{</span><span style=color:#e6db74>\</span><span style=color:#e6db74>{</span><span style=color:#e6db74>/</span><span style=color:#f92672>]</span>
      p_index <span style=color:#f92672>=</span> entry_block<span style=color:#f92672>.</span>index para
      delete_lines <span style=color:#f92672>&lt;&lt;</span> entry_block<span style=color:#f92672>[</span>p_index <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#f92672></span><span style=color:#f92672>]</span> <span style=color:#66d9ef>if</span> entry_block<span style=color:#f92672>[</span>p_index <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#f92672></span><span style=color:#f92672>]</span><span style=color:#f92672>[</span><span style=color:#e6db74>/</span><span style=color:#e6db74>\</span><span style=color:#e6db74>A</span><span style=color:#e6db74>#{</span>caption<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#f92672>]</span>
      <span style=color:#66d9ef>if</span> entry_block<span style=color:#f92672>[</span>(p_index <span style=color:#f92672>+</span> <span style=color:#ae81ff>5</span><span style=color:#f92672></span>)<span style=color:#f92672>]</span> <span style=color:#f92672>=~</span> file_pattern
        full_pict_ref <span style=color:#f92672>=</span> $1<span style=color:#f92672>.</span>strip
        picture_to_copy <span style=color:#f92672>=</span> $2<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>/</span><span style=color:#e6db74>&#34;</span>)<span style=color:#f92672>.</span>last
        delete_lines <span style=color:#f92672>&lt;&lt;</span> entry_block<span style=color:#f92672>[</span>p_index <span style=color:#f92672>+</span> <span style=color:#ae81ff>5</span><span style=color:#f92672></span><span style=color:#f92672>]</span>
        picture_to_copy <span style=color:#f92672>=</span> copy_over_pictures( picture_to_copy )
      <span style=color:#66d9ef>end</span>
      <span style=color:#66d9ef>if</span> picture_to_copy
        entry_block<span style=color:#f92672>[</span>p_index<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>#{</span>pict_line<span style=color:#e6db74>}</span><span style=color:#e6db74>({{ site.url }}{{ site.root }}{{ site.images_dir }}/{{ page.date | date: </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>%Y</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74> }}/</span><span style=color:#e6db74>#{</span>picture_to_copy<span style=color:#e6db74>}</span><span style=color:#e6db74>)][</span><span style=color:#e6db74>#{</span>full_pict_ref<span style=color:#e6db74>}</span><span style=color:#e6db74>]</span><span style=color:#e6db74>&#34;</span>
      <span style=color:#66d9ef>end</span>
    <span style=color:#66d9ef>end</span>
  <span style=color:#66d9ef>end</span>
  delete_lines<span style=color:#f92672>.</span>each{ <span style=color:#f92672>|</span> line <span style=color:#f92672>|</span> entry_block<span style=color:#f92672>.</span>delete( line ) }
  <span style=color:#66d9ef>return</span> entry_block
<span style=color:#66d9ef>end</span>

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e></span><span style=color:#f92672></span><span style=color:#a6e22e>copy_over_pictures</span>( picture_name )
  location <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>find </span><span style=color:#e6db74>#{</span>@pictures_pull_dir<span style=color:#e6db74>}</span><span style=color:#e6db74> -name &#39;</span><span style=color:#e6db74>#{</span>picture_name<span style=color:#e6db74>}</span><span style=color:#e6db74>*&#39; -type f | sort -nr</span><span style=color:#e6db74>`</span>
  <span style=color:#66d9ef>if</span> location <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#34;</span>
    location <span style=color:#f92672>=</span> location<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)<span style=color:#f92672>.</span>first<span style=color:#f92672>.</span>strip  
    picture_name <span style=color:#f92672>=</span> location<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>/</span><span style=color:#e6db74>&#34;</span>)<span style=color:#f92672>.</span>last
    <span style=color:#66d9ef>if</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>ls </span><span style=color:#e6db74>#{</span>@pictures_push_dir<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>#{</span>@publish_year<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#34;</span>; <span style=color:#e6db74>`</span><span style=color:#e6db74>mkdir </span><span style=color:#e6db74>#{</span>@pictures_push_dir<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>#{</span>@publish_year<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>; <span style=color:#66d9ef>end</span>
    <span style=color:#e6db74>`</span><span style=color:#e6db74>cp </span><span style=color:#e6db74>#{</span>location<span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>#{</span>@pictures_push_dir<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>#{</span>@publish_year<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>#{</span>picture_name<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>
    <span style=color:#66d9ef>return</span> picture_name
  <span style=color:#66d9ef>else</span>
    <span style=color:#e6db74>`</span><span style=color:#e6db74>echo &#34;Error importing to </span><span style=color:#e6db74>#{</span>@publish_year<span style=color:#e6db74>}</span><span style=color:#e6db74> the file: </span><span style=color:#e6db74>#{</span>location<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>#{</span>picture_name<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34; &gt;&gt; cleaner-errors.log</span><span style=color:#e6db74>`</span>  
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span></code></pre></div><p>That was it. Just a few regexs and a few deletes and a few system commands.</p><h3 id=step-4-put-it-all-together--see-what-we-have>Step 4. Put it all Together && See What We Have</h3><p>After I built the script and tested it on a few of the more recent posts I needed to run it on the entire directory of posts. I kept the posts in a separate directory out of the repo so if anything got screwed up with the script I could just re run it. I ended up having to do that a couple of times as I had to tweak my original version of the script a bit to arrive at what is presented above.</p><pre><code>rm -rf _posts &amp;&amp; cp ~/Downloads/jekyll-export/_posts . -R &amp;&amp; git add _posts &amp;&amp; ./cleaner.rb
</code></pre><p>One of the first things I realized was that I needed to add the <code>_posts</code> dir to the the repo again as when you run jekyll it will <code>git ls-files</code>. So I ran the above command until I was happy with the results and then I finally ran this command.</p><pre><code>rm -rf _posts &amp;&amp; cp ~/Downloads/jekyll-export/_posts . -R &amp;&amp; git add _posts &amp;&amp; ./cleaner.rb &amp;&amp; rake site:publish
</code></pre><p>That was it! The full cleaner script can be found in <a href=https://gist.github.com/compleatang/5401492>this gist</a>. If you want to use it, download it into the root of Jekyll, <code>chmod +x cleaner.rb</code> and you will be all set.</p><h3 id=lessons-learned>Lessons Learned.</h3><ul><li>Testing of scripts is huge. I still don't really know how to do this but I tested it with sample data and was prepared for things to go wrong.</li><li>Backticks. FTW.</li></ul><p>~ # ~</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://caseykuhlman.com/tags/ruby>ruby</a></span><span class=tag><a href=https://caseykuhlman.com/tags/jekyll>jekyll</a></span><span class=tag><a href=https://caseykuhlman.com/tags/blogging>blogging</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=https://github.com/compleatang/site/commit/776ddcabdd2558df7ebb2dc09365f27e2febb7d0 target=_blank rel=noopener>776ddca</a> @ 2020-04-11</p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2020</span>
<span><a href=https://caseykuhlman.com/>Casey Kuhlman</a></span>
<span>All Content Licensed CC BY-NC-SA 4.0</span>
<span><a href=https://caseykuhlman.com/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084; by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span></div></div></footer></div><script type=text/javascript src=/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script><script src=//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js></script><script src=//static.getclicky.com/js></script><script src=/js/udb.js></script></body></html>